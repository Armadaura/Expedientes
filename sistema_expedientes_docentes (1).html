<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Expedientes Docentes</title>
    <style>
        /* Estilos CSS existentes */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #8B0000 0%, #000000 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
            width: 100%;
            max-width: 1200px;
            min-height: 600px;
        }
        .header {
            background: linear-gradient(135deg, #8B0000, #000000);
            color: white;
            padding: 20px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        .logo {
            width: 100px;
            height: auto;
            margin-bottom: 10px;
        }
        .content {
            padding: 30px;
        }
        .login-form, .register-form {
            max-width: 400px;
            margin: 0 auto;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
        }
        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        .form-group input:focus {
            outline: none;
            border-color: #8B0000;
        }
        .btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #8B0000, #000000);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.3s;
        }
        .btn:hover {
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: linear-gradient(135deg, #444, #000);
            margin-top: 10px;
        }
        .expediente-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
            height: 500px;
        }
        .sidebar {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
        }
        .sidebar h3 {
            color: #8B0000;
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        .section-item {
            padding: 10px;
            margin-bottom: 8px;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 4px solid #8B0000;
        }
        .section-item:hover {
            background: #f8d7da;
            transform: translateX(5px);
        }
        .section-item.active {
            background: #8B0000;
            color: white;
        }
        .main-content {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 20px;
            overflow-y: auto;
        }
        .section-content {
            display: none;
        }
        .section-content.active {
            display: block;
        }
        .section-content h2 {
            color: #8B0000;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8B0000;
        }
        .file-upload-area {
            border: 2px dashed #8B0000;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .file-upload-area:hover {
            background: #f0f8ff;
            border-color: #8B0000;
        }
        .file-list {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .file-item:last-child {
            border-bottom: none;
        }
        .file-icon {
            width: 20px;
            height: 20px;
            background: #e74c3c;
            border-radius: 3px;
            margin-right: 10px;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background: #8B0000;
            color: white;
            border-radius: 8px;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .logout-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }
        .backup-btn {
            background: #27ae60;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-right: 10px;
        }
        .hidden {
            display: none;
        }
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            text-align: center;
        }
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .subsection {
            margin-left: 20px;
            margin-top: 10px;
        }
        .subsection-item {
            padding: 8px;
            margin-bottom: 5px;
            background: #f8d7da;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            border-left: 3px solid #8B0000;
        }
        .subsection-item:hover {
            background: #f1b5b5;
        }
        .form-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-row .form-group {
            flex: 1;
        }
        .data-form {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .data-form h3 {
            color: #8B0000;
            margin-bottom: 15px;
        }
        .saved-data {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }
        .saved-data h4 {
            color: #27ae60;
            margin-bottom: 10px;
        }
        .data-item {
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 5px;
            border-left: 3px solid #27ae60;
        }
        .edit-btn, .delete-btn {
            background: #f39c12;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 3px;
            cursor: pointer;
            margin-right: 5px;
            font-size: 0.8rem;
        }
        .delete-btn {
            background: #e74c3c;
        }
        .user-management {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .user-management h3 {
            color: #8B0000;
            margin-bottom: 15px;
        }
        .user-list {
            margin-top: 10px;
        }
        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }
        .user-item:last-child {
            border-bottom: none;
        }
        .pdf-preview {
            width: 100%;
            height: 500px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-top: 20px;
        }
        .profile-image {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <img src="https://mistralaichatupprodswe.blob.core.windows.net/chat-images/70/4c/6f/704c6f12-f384-4de0-a061-d8fe495d6965/4d35c87f-6435-4dd7-9057-5e34ae5ea6e8/434aa111-f534-4538-a612-7905c36825bf?sv=2025-01-05&st=2025-07-17T15%3A36%3A39Z&se=2025-07-17T16%3A36%3A39Z&sr=b&sp=rade&sig=XEp%2BENVD6MBCr59pkh2kJP6g%2FgfL9X5eA0ky1UQKnI4%3D" alt="Logo" class="logo" id="logo">
            <h1>Sistema de Expedientes Docentes</h1>
            <p>Gesti√≥n Integral de Documentaci√≥n Acad√©mica</p>
        </div>
        <!-- Pantalla de Login -->
        <div id="loginScreen" class="content">
            <div class="login-form">
                <h2 style="text-align: center; margin-bottom: 30px; color: #8B0000;">Iniciar Sesi√≥n</h2>
                <div id="loginAlert"></div>
                <form id="loginForm">
                    <div class="form-group">
                        <label for="username">Usuario:</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Contrase√±a:</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <button type="submit" class="btn">Iniciar Sesi√≥n</button>
                    <button type="button" class="btn btn-secondary" onclick="showRegister()">Registrarse</button>
                </form>
            </div>
        </div>
        <!-- Pantalla de Registro -->
        <div id="registerScreen" class="content hidden">
            <div class="register-form">
                <h2 style="text-align: center; margin-bottom: 30px; color: #8B0000;">Registro de Usuario</h2>
                <div id="registerAlert"></div>
                <form id="registerForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="regFirstName">Nombres:</label>
                            <input type="text" id="regFirstName" name="firstName" required>
                        </div>
                        <div class="form-group">
                            <label for="regLastName">Apellidos:</label>
                            <input type="text" id="regLastName" name="lastName" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="regUsername">Nombre de Usuario:</label>
                        <input type="text" id="regUsername" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="regPassword">Contrase√±a:</label>
                        <input type="password" id="regPassword" name="password" required>
                    </div>
                    <div class="form-group">
                        <label for="regConfirmPassword">Confirmar Contrase√±a:</label>
                        <input type="password" id="regConfirmPassword" name="confirmPassword" required>
                    </div>
                    <button type="submit" class="btn">Registrarse</button>
                    <button type="button" class="btn btn-secondary" onclick="showLogin()">Volver al Login</button>
                </form>
            </div>
        </div>
        <!-- Pantalla Principal del Sistema -->
        <div id="mainScreen" class="content hidden">
            <div class="top-bar">
                <div class="user-info">
                    <img id="profileImage" class="profile-image" src="" alt="Profile Image">
                    <span id="currentUser">Usuario: Admin</span>
                </div>
                <div>
                    <button class="backup-btn" onclick="generateBackup()">Generar Backup</button>
                    <button class="backup-btn" onclick="document.getElementById('backupFile').click()">Cargar Backup</button>
                    <input type="file" id="backupFile" accept=".json" style="display: none;" onchange="loadBackup(event)">
                    <button class="logout-btn" onclick="logout()">Cerrar Sesi√≥n</button>
                </div>
            </div>
            <div class="expediente-container">
                <div class="sidebar">
                    <h3>Secciones del Expediente</h3>
                    <div class="section-item active" onclick="showSection('datos-personales')">
                        üìÅ 1. Datos Personales
                    </div>
                    <div class="section-item" onclick="showSection('formacion-academica')">
                        üìÅ 2. Formaci√≥n Acad√©mica
                        <div class="subsection">
                            <div class="subsection-item" onclick="showSubsection('titulos-tercer-nivel')">üìÑ 2.2. TITULOS TERCER NIVEL</div>
                            <div class="subsection-item" onclick="showSubsection('titulos-cuarto-nivel')">üìÑ 2.3. TITULOS DE CUARTO NIVEL</div>
                        </div>
                    </div>
                    <div class="section-item" onclick="showSection('actualizacion-academica')">
                        üìÅ 3. Actualizaci√≥n Acad√©mica
                    </div>
                    <div class="section-item" onclick="showSection('experiencia-profesional')">
                        üìÅ 4. Experiencia Profesional
                    </div>
                    <div class="section-item" onclick="showSection('relacion-laboral')">
                        üìÅ 5. Relaci√≥n Laboral
                    </div>
                    <div class="section-item" onclick="showSection('cargos-directivos')">
                        üìÅ 6. Cargos Directivos
                    </div>
                    <div class="section-item" onclick="showSection('vinculacion-colectividad')">
                        üìÅ 7. Vinculaci√≥n con la Colectividad
                    </div>
                    <div class="section-item" onclick="showSection('investigacion')">
                        üìÅ 8. Investigaci√≥n
                    </div>
                    <div class="section-item" onclick="showSection('publicaciones')">
                        üìÅ 9. Publicaciones
                    </div>
                    <div class="section-item" onclick="showSection('admin-panel')" id="adminPanelItem" style="display: none;">
                        üõ†Ô∏è Panel de Administraci√≥n
                    </div>
                </div>
                <div class="main-content">
                    <!-- Secci√≥n Datos Personales -->
                    <div id="datos-personales" class="section-content active">
                        <h2>1. Datos Personales</h2>
                        <div class="data-form">
                            <h3>Informaci√≥n Personal</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Nombres:</label>
                                    <input type="text" id="nombres" placeholder="Ingrese nombres completos">
                                </div>
                                <div class="form-group">
                                    <label>Apellidos:</label>
                                    <input type="text" id="apellidos" placeholder="Ingrese apellidos completos">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>C√©dula:</label>
                                    <input type="text" id="cedula" placeholder="N√∫mero de c√©dula">
                                </div>
                                <div class="form-group">
                                    <label>Fecha de Nacimiento:</label>
                                    <input type="date" id="fechaNacimiento">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Tel√©fono:</label>
                                    <input type="tel" id="telefono" placeholder="N√∫mero de tel√©fono">
                                </div>
                                <div class="form-group">
                                    <label>Email:</label>
                                    <input type="email" id="email" placeholder="Correo electr√≥nico">
                                </div>
                            </div>
                            <button class="btn" onclick="savePersonalData()">Guardar Datos</button>
                        </div>
                        <div class="saved-data">
                            <h4>Datos Guardados:</h4>
                            <div id="personalDataDisplay"></div>
                        </div>
                    </div>
                    <!-- Secci√≥n Formaci√≥n Acad√©mica -->
                    <div id="formacion-academica" class="section-content">
                        <h2>2. Formaci√≥n Acad√©mica</h2>
                        <div id="titulos-tercer-nivel" class="subsection-content">
                            <h3>2.2. T√≠tulos de Tercer Nivel</h3>
                            <div class="file-upload-area" onclick="document.getElementById('tercerNivelFiles').click()">
                                <p>üìÅ Haz clic para subir documentos de t√≠tulos de tercer nivel</p>
                                <input type="file" id="tercerNivelFiles" accept=".pdf" style="display: none;" onchange="handleFileUpload(event, 'titulos-tercer-nivel')">
                            </div>
                            <div class="file-list" id="tercerNivelFileList">
                                <h4>Documentos de T√≠tulos de Tercer Nivel:</h4>
                                <div id="tercerNivelFiles-list"></div>
                            </div>
                        </div>
                        <div id="titulos-cuarto-nivel" class="subsection-content">
                            <h3>2.3. T√≠tulos de Cuarto Nivel</h3>
                            <div class="file-upload-area" onclick="document.getElementById('cuartoNivelFiles').click()">
                                <p>üìÅ Haz clic para subir documentos de t√≠tulos de cuarto nivel</p>
                                <input type="file" id="cuartoNivelFiles" accept=".pdf" style="display: none;" onchange="handleFileUpload(event, 'titulos-cuarto-nivel')">
                            </div>
                            <div class="file-list" id="cuartoNivelFileList">
                                <h4>Documentos de T√≠tulos de Cuarto Nivel:</h4>
                                <div id="cuartoNivelFiles-list"></div>
                            </div>
                        </div>
                    </div>
                    <!-- Secci√≥n Actualizaci√≥n Acad√©mica -->
                    <div id="actualizacion-academica" class="section-content">
                        <h2>3. Actualizaci√≥n Acad√©mica</h2>
                        <div class="file-upload-area" onclick="document.getElementById('actualizacionFiles').click()">
                            <p>üìÅ Haz clic para subir documentos de actualizaci√≥n acad√©mica</p>
                            <input type="file" id="actualizacionFiles" accept=".pdf" style="display: none;" onchange="handleFileUpload(event, 'actualizacion-academica')">
                        </div>
                        <div class="file-list" id="actualizacionFileList">
                            <h4>Documentos de Actualizaci√≥n Acad√©mica:</h4>
                            <div id="actualizacionFiles-list"></div>
                        </div>
                    </div>
                    <!-- Secci√≥n Experiencia Profesional -->
                    <div id="experiencia-profesional" class="section-content">
                        <h2>4. Experiencia Profesional</h2>
                        <div class="file-upload-area" onclick="document.getElementById('experienciaFiles').click()">
                            <p>üìÅ Haz clic para subir documentos de experiencia profesional</p>
                            <input type="file" id="experienciaFiles" accept=".pdf" style="display: none;" onchange="handleFileUpload(event, 'experiencia-profesional')">
                        </div>
                        <div class="file-list" id="experienciaFileList">
                            <h4>Documentos de Experiencia Profesional:</h4>
                            <div id="experienciaFiles-list"></div>
                        </div>
                    </div>
                    <!-- Secci√≥n Relaci√≥n Laboral -->
                    <div id="relacion-laboral" class="section-content">
                        <h2>5. Relaci√≥n Laboral</h2>
                        <div class="file-upload-area" onclick="document.getElementById('relacionFiles').click()">
                            <p>üìÅ Haz clic para subir documentos de relaci√≥n laboral</p>
                            <input type="file" id="relacionFiles" accept=".pdf" style="display: none;" onchange="handleFileUpload(event, 'relacion-laboral')">
                        </div>
                        <div class="file-list" id="relacionFileList">
                            <h4>Documentos de Relaci√≥n Laboral:</h4>
                            <div id="relacionFiles-list"></div>
                        </div>
                    </div>
                    <!-- Secci√≥n Cargos Directivos -->
                    <div id="cargos-directivos" class="section-content">
                        <h2>6. Cargos Directivos</h2>
                        <div class="file-upload-area" onclick="document.getElementById('directivosFiles').click()">
                            <p>üìÅ Haz clic para subir documentos de cargos directivos</p>
                            <input type="file" id="directivosFiles" accept=".pdf" style="display: none;" onchange="handleFileUpload(event, 'cargos-directivos')">
                        </div>
                        <div class="file-list" id="directivosFileList">
                            <h4>Documentos de Cargos Directivos:</h4>
                            <div id="directivosFiles-list"></div>
                        </div>
                    </div>
                    <!-- Secci√≥n Vinculaci√≥n con la Colectividad -->
                    <div id="vinculacion-colectividad" class="section-content">
                        <h2>7. Vinculaci√≥n con la Colectividad</h2>
                        <div class="file-upload-area" onclick="document.getElementById('vinculacionFiles').click()">
                            <p>üìÅ Haz clic para subir documentos de vinculaci√≥n con la colectividad</p>
                            <input type="file" id="vinculacionFiles" accept=".pdf" style="display: none;" onchange="handleFileUpload(event, 'vinculacion-colectividad')">
                        </div>
                        <div class="file-list" id="vinculacionFileList">
                            <h4>Documentos de Vinculaci√≥n con la Colectividad:</h4>
                            <div id="vinculacionFiles-list"></div>
                        </div>
                    </div>
                    <!-- Secci√≥n Investigaci√≥n -->
                    <div id="investigacion" class="section-content">
                        <h2>8. Investigaci√≥n</h2>
                        <div class="file-upload-area" onclick="document.getElementById('investigacionFiles').click()">
                            <p>üìÅ Haz clic para subir documentos de investigaci√≥n</p>
                            <input type="file" id="investigacionFiles" accept=".pdf" style="display: none;" onchange="handleFileUpload(event, 'investigacion')">
                        </div>
                        <div class="file-list" id="investigacionFileList">
                            <h4>Documentos de Investigaci√≥n:</h4>
                            <div id="investigacionFiles-list"></div>
                        </div>
                    </div>
                    <!-- Secci√≥n Publicaciones -->
                    <div id="publicaciones" class="section-content">
                        <h2>9. Publicaciones</h2>
                        <div class="file-upload-area" onclick="document.getElementById('publicacionesFiles').click()">
                            <p>üìÅ Haz clic para subir documentos de publicaciones</p>
                            <input type="file" id="publicacionesFiles" accept=".pdf" style="display: none;" onchange="handleFileUpload(event, 'publicaciones')">
                        </div>
                        <div class="file-list" id="publicacionesFileList">
                            <h4>Documentos de Publicaciones:</h4>
                            <div id="publicacionesFiles-list"></div>
                        </div>
                    </div>
                    <!-- Secci√≥n Panel de Administraci√≥n -->
                    <div id="admin-panel" class="section-content">
                        <h2>Panel de Administraci√≥n</h2>
                        <div class="data-form">
                            <h3>Configurar Logo</h3>
                            <div class="file-upload-area" onclick="document.getElementById('logoFile').click()">
                                <p>üìÅ Haz clic para subir un nuevo logo</p>
                                <input type="file" id="logoFile" accept="image/*" style="display: none;" onchange="handleLogoUpload(event)">
                            </div>
                        </div>
                        <div class="user-management">
                            <h3>Lista de Usuarios</h3>
                            <div class="user-list" id="userList">
                                <!-- Lista de usuarios se llenar√° aqu√≠ -->
                            </div>
                        </div>
                        <div class="data-form">
                            <h3>Lista de Archivos Subidos</h3>
                            <div class="file-list" id="adminFileList">
                                <!-- Lista de archivos se llenar√° aqu√≠ -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
    <script>
        // Variables globales
        let currentUser = null;
        let users = [];
        let expedientesData = {};
        let filesData = {};
        let logoImage = null;
        let profileImage = null;

        // Inicializar sistema
        function initSystem() {
            // Crear usuario administrador por defecto
            if (!users.find(u => u.username === 'admin')) {
                users.push({
                    username: 'admin',
                    password: 'bolivar2025',
                    firstName: 'Administrador',
                    lastName: 'del Sistema',
                    role: 'admin'
                });
            }
            // Cargar datos guardados
            loadFromStorage();
            // Mostrar u ocultar el panel de administraci√≥n seg√∫n el rol del usuario
            updateAdminPanelVisibility();
        }

        // Funciones de autenticaci√≥n
        function showLogin() {
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.add('hidden');
        }

        function showRegister() {
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('registerScreen').classList.remove('hidden');
            document.getElementById('mainScreen').classList.add('hidden');
        }

        function showAlert(elementId, message, type) {
            const alertElement = document.getElementById(elementId);
            alertElement.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            setTimeout(() => {
                alertElement.innerHTML = '';
            }, 5000);
        }

        // Manejo del login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                currentUser = user;
                document.getElementById('currentUser').textContent = `Usuario: ${user.firstName} ${user.lastName}`;
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('mainScreen').classList.remove('hidden');
                updateAdminPanelVisibility();
                showAlert('loginAlert', 'Inicio de sesi√≥n exitoso', 'success');
                // Mostrar datos guardados
                displayPersonalData();
                displayAcademicUpdates();
                displayExperiences();
                // Mostrar archivos subidos
                Object.keys(filesData).forEach(section => {
                    displayFiles(section);
                });
                // Mostrar lista de usuarios y archivos si es administrador
                if (currentUser.role === 'admin') {
                    displayUserList();
                    displayAdminFileList();
                }
                // Mostrar imagen de perfil si existe
                if (profileImage) {
                    document.getElementById('profileImage').src = profileImage;
                }
            } else {
                showAlert('loginAlert', 'Usuario o contrase√±a incorrectos', 'error');
            }
        });

        // Manejo del registro
        document.getElementById('registerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const firstName = document.getElementById('regFirstName').value;
            const lastName = document.getElementById('regLastName').value;
            const username = document.getElementById('regUsername').value;
            const password = document.getElementById('regPassword').value;
            const confirmPassword = document.getElementById('regConfirmPassword').value;

            // Validaciones
            if (password !== confirmPassword) {
                showAlert('registerAlert', 'Las contrase√±as no coinciden', 'error');
                return;
            }
            if (users.find(u => u.username === username)) {
                showAlert('registerAlert', 'El nombre de usuario ya existe', 'error');
                return;
            }

            // Crear nuevo usuario
            const newUser = {
                username: username,
                password: password,
                firstName: firstName,
                lastName: lastName,
                role: 'user'
            };
            users.push(newUser);
            saveToStorage();
            showAlert('registerAlert', 'Usuario registrado exitosamente', 'success');

            // Iniciar sesi√≥n autom√°ticamente despu√©s del registro
            currentUser = newUser;
            document.getElementById('currentUser').textContent = `Usuario: ${newUser.firstName} ${newUser.lastName}`;
            document.getElementById('registerScreen').classList.add('hidden');
            document.getElementById('mainScreen').classList.remove('hidden');
            updateAdminPanelVisibility();

            // Limpiar formulario
            document.getElementById('registerForm').reset();
        });

        // Cerrar sesi√≥n
        function logout() {
            currentUser = null;
            document.getElementById('loginScreen').classList.remove('hidden');
            document.getElementById('mainScreen').classList.add('hidden');
            document.getElementById('loginForm').reset();
        }

        // Funciones de navegaci√≥n
        function showSection(sectionId) {
            // Ocultar todas las secciones
            const sections = document.querySelectorAll('.section-content');
            sections.forEach(section => section.classList.remove('active'));

            // Remover active de todos los items
            const items = document.querySelectorAll('.section-item');
            items.forEach(item => item.classList.remove('active'));

            // Mostrar secci√≥n seleccionada
            document.getElementById(sectionId).classList.add('active');

            // Marcar item como activo
            event.target.classList.add('active');
        }

        function showSubsection(subsectionId) {
            // Ocultar todas las subsecciones
            const subsections = document.querySelectorAll('.subsection-content');
            subsections.forEach(subsection => subsection.classList.remove('active'));

            // Mostrar subsecci√≥n seleccionada
            document.getElementById(subsectionId).classList.add('active');
        }

        // Mostrar u ocultar el panel de administraci√≥n seg√∫n el rol del usuario
        function updateAdminPanelVisibility() {
            const adminPanelItem = document.getElementById('adminPanelItem');
            if (currentUser && currentUser.role === 'admin') {
                adminPanelItem.style.display = 'block';
            } else {
                adminPanelItem.style.display = 'none';
            }
        }

        // Funciones de manejo de archivos
        function handleFileUpload(event, section) {
            const files = event.target.files;
            if (!filesData[section]) {
                filesData[section] = [];
            }
            for (let file of files) {
                if (file.type !== 'application/pdf') {
                    alert('Solo se permiten archivos PDF.');
                    return;
                }
                if (file.size > 5 * 1024 * 1024) {
                    alert('El archivo es demasiado grande. El tama√±o m√°ximo es de 5 MB.');
                    return;
                }
                const reader = new FileReader();
                reader.onload = function(e) {
                    const fileData = {
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        lastModified: file.lastModified,
                        id: Date.now() + Math.random(),
                        data: e.target.result,
                        timestamp: new Date().toISOString()
                    };
                    filesData[section].push(fileData);
                    displayFiles(section);
                    saveToStorage();
                };
                reader.readAsDataURL(file);
            }
        }

        function displayFiles(section) {
            const listElement = document.getElementById(`${section}Files-list`) || document.getElementById(`${section.replace('-', '')}Files-list`);
            if (!listElement) return;

            const files = filesData[section] || [];
            if (files.length === 0) {
                listElement.innerHTML = '<p>No hay documentos guardados</p>';
                return;
            }

            let html = '';
            files.forEach(file => {
                const date = new Date(file.timestamp);
                const formattedDate = date.toLocaleString();
                html += `
                    <div class="file-item">
                        <div class="file-icon"></div>
                        <div style="flex: 1;">
                            <strong>${file.name}</strong>
                            <small>(${formatFileSize(file.size)})</small><br>
                            <small>Subido: ${formattedDate}</small>
                        </div>
                        <div>
                            <button class="edit-btn" onclick="viewFile('${file.data}')">Ver</button>
                            ${currentUser.role === 'admin' ? `<button class="delete-btn" onclick="deleteFile('${section}', '${file.id}')">Eliminar</button>` : ''}
                        </div>
                    </div>
                `;
            });
            listElement.innerHTML = html;
        }

        function viewFile(fileData) {
            const pdfData = atob(fileData.split(',')[1]);
            const loadingTask = pdfjsLib.getDocument({ data: pdfData });
            loadingTask.promise.then(function(pdf) {
                pdf.getPage(1).then(function(page) {
                    const scale = 1.5;
                    const viewport = page.getViewport({ scale: scale });
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.height = viewport.height;
                    canvas.width = viewport.width;
                    const renderContext = {
                        canvasContext: context,
                        viewport: viewport
                    };
                    page.render(renderContext).promise.then(function() {
                        const previewContainer = document.createElement('div');
                        previewContainer.className = 'pdf-preview';
                        previewContainer.appendChild(canvas);
                        const mainContent = document.querySelector('.main-content');
                        mainContent.insertBefore(previewContainer, mainContent.firstChild);
                    });
                });
            }, function(reason) {
                console.error(reason);
            });
        }

        function deleteFile(section, fileId) {
            if (currentUser.role !== 'admin') {
                alert('Solo el administrador puede eliminar archivos.');
                return;
            }
            if (confirm('¬øEst√° seguro de eliminar este archivo?')) {
                filesData[section] = filesData[section].filter(file => file.id != fileId);
                displayFiles(section);
                saveToStorage();
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Funciones para guardar datos espec√≠ficos
        function savePersonalData() {
            const personalData = {
                nombres: document.getElementById('nombres').value,
                apellidos: document.getElementById('apellidos').value,
                cedula: document.getElementById('cedula').value,
                fechaNacimiento: document.getElementById('fechaNacimiento').value,
                telefono: document.getElementById('telefono').value,
                email: document.getElementById('email').value,
                timestamp: new Date().toISOString()
            };
            if (!expedientesData.personalData) {
                expedientesData.personalData = [];
            }
            expedientesData.personalData.push(personalData);
            displayPersonalData();
            saveToStorage();

            // Limpiar formulario
            document.getElementById('nombres').value = '';
            document.getElementById('apellidos').value = '';
            document.getElementById('cedula').value = '';
            document.getElementById('fechaNacimiento').value = '';
            document.getElementById('telefono').value = '';
            document.getElementById('email').value = '';
            alert('Datos personales guardados exitosamente');
        }

        function displayPersonalData() {
            const container = document.getElementById('personalDataDisplay');
            const data = expedientesData.personalData || [];
            if (data.length === 0) {
                container.innerHTML = '<p>No hay datos guardados</p>';
                return;
            }
            let html = '';
            data.forEach((item, index) => {
                const date = new Date(item.timestamp);
                const formattedDate = date.toLocaleString();
                html += `
                    <div class="data-item">
                        <strong>${item.nombres} ${item.apellidos}</strong><br>
                        <small>C√©dula: ${item.cedula} | Tel√©fono: ${item.telefono} | Email: ${item.email}</small><br>
                        <small>Fecha de nacimiento: ${item.fechaNacimiento}</small><br>
                        <small>Registrado: ${formattedDate}</small>
                        <div style="margin-top: 5px;">
                            <button class="edit-btn" onclick="editPersonalData(${index})">Editar</button>
                            <button class="delete-btn" onclick="deletePersonalData(${index})">Eliminar</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function deletePersonalData(index) {
            if (confirm('¬øEst√° seguro de eliminar este registro?')) {
                expedientesData.personalData.splice(index, 1);
                displayPersonalData();
                saveToStorage();
            }
        }

        function saveAcademicUpdate() {
            const academicData = {
                nombreCurso: document.getElementById('nombreCurso').value,
                institucionCurso: document.getElementById('institucionCurso').value,
                anioCurso: document.getElementById('anioCurso').value,
                horasCurso: document.getElementById('horasCurso').value,
                timestamp: new Date().toISOString()
            };
            if (!expedientesData.academicUpdates) {
                expedientesData.academicUpdates = [];
            }
            expedientesData.academicUpdates.push(academicData);
            displayAcademicUpdates();
            saveToStorage();

            // Limpiar formulario
            document.getElementById('nombreCurso').value = '';
            document.getElementById('institucionCurso').value = '';
            document.getElementById('anioCurso').value = '';
            document.getElementById('horasCurso').value = '';
            alert('Actualizaci√≥n acad√©mica guardada exitosamente');
        }

        function displayAcademicUpdates() {
            const container = document.getElementById('academicUpdateDisplay');
            const data = expedientesData.academicUpdates || [];
            if (data.length === 0) {
                container.innerHTML = '<p>No hay cursos registrados</p>';
                return;
            }
            let html = '';
            data.forEach((item, index) => {
                const date = new Date(item.timestamp);
                const formattedDate = date.toLocaleString();
                html += `
                    <div class="data-item">
                        <strong>${item.nombreCurso}</strong><br>
                        <small>Instituci√≥n: ${item.institucionCurso}</small><br>
                        <small>A√±o: ${item.anioCurso} | Horas: ${item.horasCurso}</small><br>
                        <small>Registrado: ${formattedDate}</small>
                        <div style="margin-top: 5px;">
                            <button class="edit-btn" onclick="editAcademicUpdate(${index})">Editar</button>
                            <button class="delete-btn" onclick="deleteAcademicUpdate(${index})">Eliminar</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function deleteAcademicUpdate(index) {
            if (confirm('¬øEst√° seguro de eliminar este registro?')) {
                expedientesData.academicUpdates.splice(index, 1);
                displayAcademicUpdates();
                saveToStorage();
            }
        }

        function saveExperience() {
            const experienceData = {
                cargoExp: document.getElementById('cargoExp').value,
                empresaExp: document.getElementById('empresaExp').value,
                fechaInicioExp: document.getElementById('fechaInicioExp').value,
                fechaFinExp: document.getElementById('fechaFinExp').value,
                descripcionExp: document.getElementById('descripcionExp').value,
                timestamp: new Date().toISOString()
            };
            if (!expedientesData.experiences) {
                expedientesData.experiences = [];
            }
            expedientesData.experiences.push(experienceData);
            displayExperiences();
            saveToStorage();

            // Limpiar formulario
            document.getElementById('cargoExp').value = '';
            document.getElementById('empresaExp').value = '';
            document.getElementById('fechaInicioExp').value = '';
            document.getElementById('fechaFinExp').value = '';
            document.getElementById('descripcionExp').value = '';
            alert('Experiencia profesional guardada exitosamente');
        }

        function displayExperiences() {
            const container = document.getElementById('experienceDisplay');
            const data = expedientesData.experiences || [];
            if (data.length === 0) {
                container.innerHTML = '<p>No hay experiencia registrada</p>';
                return;
            }
            let html = '';
            data.forEach((item, index) => {
                const date = new Date(item.timestamp);
                const formattedDate = date.toLocaleString();
                html += `
                    <div class="data-item">
                        <strong>${item.cargoExp}</strong> - ${item.empresaExp}<br>
                        <small>Per√≠odo: ${item.fechaInicioExp} - ${item.fechaFinExp}</small><br>
                        <small>Descripci√≥n: ${item.descripcionExp}</small><br>
                        <small>Registrado: ${formattedDate}</small>
                        <div style="margin-top: 5px;">
                            <button class="edit-btn" onclick="editExperience(${index})">Editar</button>
                            <button class="delete-btn" onclick="deleteExperience(${index})">Eliminar</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function deleteExperience(index) {
            if (confirm('¬øEst√° seguro de eliminar este registro?')) {
                expedientesData.experiences.splice(index, 1);
                displayExperiences();
                saveToStorage();
            }
        }

        function saveRelacionLaboral() {
            const relacionLaboralData = {
                descripcion: document.getElementById('descripcionRelacionLaboral').value,
                timestamp: new Date().toISOString()
            };
            if (!expedientesData.relacionLaboral) {
                expedientesData.relacionLaboral = [];
            }
            expedientesData.relacionLaboral.push(relacionLaboralData);
            alert('Informaci√≥n de relaci√≥n laboral guardada exitosamente');
            saveToStorage();

            // Limpiar formulario
            document.getElementById('descripcionRelacionLaboral').value = '';
        }

        // Funci√≥n para manejar la subida del logo
        function handleLogoUpload(event) {
            if (currentUser.role !== 'admin') {
                alert('Solo el administrador puede cambiar el logo.');
                return;
            }
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoImage = e.target.result;
                    document.getElementById('logo').src = logoImage;
                    saveToStorage();
                    alert('Logo actualizado exitosamente');
                };
                reader.readAsDataURL(file);
            }
        }

        // Funci√≥n para manejar la subida de la imagen de perfil
        function handleProfileImageUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    profileImage = e.target.result;
                    document.getElementById('profileImage').src = profileImage;
                    saveToStorage();
                    alert('Imagen de perfil actualizada exitosamente');
                };
                reader.readAsDataURL(file);
            }
        }

        // Funci√≥n para mostrar la lista de usuarios (solo administrador)
        function displayUserList() {
            const container = document.getElementById('userList');
            if (currentUser.role !== 'admin') {
                container.innerHTML = '<p>No tienes permiso para ver esta informaci√≥n.</p>';
                return;
            }
            let html = '';
            users.forEach(user => {
                html += `
                    <div class="user-item">
                        <div>
                            <strong>${user.firstName} ${user.lastName}</strong><br>
                            <small>Usuario: ${user.username}</small><br>
                            <small>Rol: ${user.role}</small>
                        </div>
                        <div>
                            <button class="delete-btn" onclick="deleteUser('${user.username}')">Eliminar</button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // Funci√≥n para eliminar usuarios (solo administrador)
        function deleteUser(username) {
            if (currentUser.role !== 'admin') {
                alert('Solo el administrador puede eliminar usuarios.');
                return;
            }
            if (username === 'admin') {
                alert('No se puede eliminar al administrador principal.');
                return;
            }
            if (confirm('¬øEst√° seguro de eliminar este usuario?')) {
                users = users.filter(user => user.username !== username);
                saveToStorage();
                displayUserList();
                alert('Usuario eliminado exitosamente');
            }
        }

        // Funci√≥n para mostrar la lista de archivos (solo administrador)
        function displayAdminFileList() {
            const container = document.getElementById('adminFileList');
            if (currentUser.role !== 'admin') {
                container.innerHTML = '<p>No tienes permiso para ver esta informaci√≥n.</p>';
                return;
            }
            let html = '<h4>Lista de Archivos Subidos:</h4>';
            Object.keys(filesData).forEach(section => {
                const files = filesData[section];
                if (files.length > 0) {
                    html += `<h5>${section}:</h5>`;
                    files.forEach(file => {
                        const date = new Date(file.timestamp);
                        const formattedDate = date.toLocaleString();
                        html += `
                            <div class="file-item">
                                <div class="file-icon"></div>
                                <div style="flex: 1;">
                                    <strong>${file.name}</strong>
                                    <small>(${formatFileSize(file.size)})</small><br>
                                    <small>Subido: ${formattedDate}</small>
                                </div>
                                <div>
                                    <button class="edit-btn" onclick="viewFile('${file.data}')">Ver</button>
                                    <button class="delete-btn" onclick="deleteFile('${section}', '${file.id}')">Eliminar</button>
                                </div>
                            </div>
                        `;
                    });
                }
            });
            if (html === '<h4>Lista de Archivos Subidos:</h4>') {
                html += '<p>No hay archivos subidos.</p>';
            }
            container.innerHTML = html;
        }

        // Funciones de almacenamiento
        function saveToStorage() {
            const data = {
                users: users,
                expedientesData: expedientesData,
                filesData: filesData,
                logoImage: logoImage,
                profileImage: profileImage
            };
            localStorage.setItem('systemData', JSON.stringify(data));
        }

        function loadFromStorage() {
            const data = localStorage.getItem('systemData');
            if (data) {
                const parsedData = JSON.parse(data);
                users = parsedData.users || [];
                expedientesData = parsedData.expedientesData || {};
                filesData = parsedData.filesData || {};
                logoImage = parsedData.logoImage || null;
                profileImage = parsedData.profileImage || null;
            } else {
                users = [{
                    username: 'admin',
                    password: 'bolivar2025',
                    firstName: 'Administrador',
                    lastName: 'del Sistema',
                    role: 'admin'
                }];
            }
        }

        // Funciones de backup
        function generateBackup() {
            if (currentUser.role !== 'admin') {
                alert('Solo el administrador puede generar backups.');
                return;
            }
            const data = {
                users: users,
                expedientesData: expedientesData,
                filesData: filesData,
                logoImage: logoImage,
                profileImage: profileImage
            };
            const dataStr = JSON.stringify(data);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'backup_' + new Date().toISOString() + '.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('Backup generado exitosamente');
        }

        function loadBackup(event) {
            if (currentUser.role !== 'admin') {
                alert('Solo el administrador puede cargar backups.');
                return;
            }
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        users = data.users || [];
                        expedientesData = data.expedientesData || {};
                        filesData = data.filesData || {};
                        logoImage = data.logoImage || null;
                        profileImage = data.profileImage || null;
                        saveToStorage();
                        alert('Backup cargado exitosamente');

                        // Actualizar la vista
                        if (logoImage) {
                            document.getElementById('logo').src = logoImage;
                        }
                        if (profileImage) {
                            document.getElementById('profileImage').src = profileImage;
                        }
                        displayUserList();
                        displayAdminFileList();
                    } catch (error) {
                        alert('Error al cargar el backup: ' + error.message);
                    }
                };
                reader.readAsText(file);
            }
        }

        // Inicializar sistema al cargar la p√°gina
        window.onload = function() {
            initSystem();
        };
    </script>
</body>
</html>
